# Coinflow API

# Пользователи

## **POST** ```/auth/register```
Регистрация нового пользователя.  

**Тело запроса**
```json
{
  "usr": {
    "email": "string",
    "login": "string",
    "name": "string",
    "password": "string",
    "phone": "string"
  }
}
```

| Поле | Значение |
| ----- | --------- |
| email | **string** <br> Email пользователя, уникальный |
| login | **string** <br> Логин пользователя, уникальный |
| name | **string** <br> Имя пользователя |
| password | **string** <br> Пароль пользователя |
| phone | **string** <br> Телефон пользователя |

**Тело ответа**
```json
{
  "user_id": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| user_id | **string** <br> UUID нового пользователя |


## **POST** ```/auth/login```
Авторизация.

**Тело запроса**
```json
{
  "login": "string",
  "password": "string"
}
```

**Тело ответа**
```json
{
  "access_token": "string",
  "refresh_token": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| access_token | **string** <br> JWT access токен. При успешной авторизации также кладется в куки
| refresh_token | **string** <br> JWT refresh токен


## **POST** ```/auth/refresh```
Выдача новых access и refresh токенов.

**Тело запроса**
```json
{
  "refresh_token": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| refresh_token | **string** <br> JWT refresh токен

**Тело ответа**
```json
{
  "access_token": "string",
  "refresh_token": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| access_token | **string** <br> JWT access токен. При успешном обновлении также кладется в куки
| refresh_token | **string** <br> JWT refresh токен

## **GET** ```/user/{user_id}```
Получение информации о пользователе.  
Защищенный эндпойнт.

| Параметр | Значение |
| ----- | --------- |
| user_id | UUID соответствующего пользователя |

**Тело ответа**
```json
{
  "id": "string",
  "login": "string",
  "name": "string",
  "email": "string",
  "phone": "string",
  "registration_timestamp": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| id | **string** <br> UUID пользователя |
| registration_timestamp | **string** <br> Время регистрации в формате RFC3339 |

# Взаимодействие с данными

## **POST** ```/commit```
Добавление пользователем произведенной им операции.  
Защищенный эндпойнт.

**Тело запроса**
```json
{
  "tx": {
    "cost": 0,
    "description": "string",
    "target": "string",
    "type": "string",
    "category": "string"
  },
  "with_auto_category": true
}
```

| Поле | Значение |
| ----- | --------- |
| cost | **integer** <br> Стоимость операции. Должна быть строго положительной |
| description | **string** <br> Описание операции |
| target | **string** <br> Наименование субъекта/организации, в отношение которого произведена операция. Например, название магазина или лицо, получившее перевод |
| type | **string** <br> Тип операции, например, покупка, перевод и т. п. [Возможные значения](VARS.md) |
| category | **string** <br> Категория операции, например, еда, развлечения, инвестиции и т. п. Указание необходимо только в случае, если поле with_auto_category имеет значение false. [Возможные значения](VARS.md) |
| with_auto_category | **boolean** <br> Указывает, должна ли категория операции определяться автоматически. Если true, то определяется сервисом с помощью языковой модели, исходя из описания операции (по сути своей, классификация текста)

**Тело ответа**

```json
{
  "tx_id": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| tx_id | **string** <br> UUID добавленной операции |

## **GET** ```/transaction/id/{tx_id}```

Получение информации об операции по ее UUID. Информация доступна только пользователю, который совершил операцию.  
Защищенный эндпойнт.

| Параметр | Значение |
| ----- | --------- |
| user_id | UUID соответствующей операции |

**Тело ответа**

```json
{
  "id": "string",
  "user_id": "string",
  "type": "string",
  "target": "string",
  "description": "string",
  "category": "string",
  "cost": 0,
  "timestamp": "string"
}
```

| Поле | Значение |
| ----- | --------- |
| id | **string** <br> UUID операции |
| user_id | **string** <br> UUID пользователя, совершившего операцию |
| timestamp | **string** <br> Время добавления операции в формате "02/01/2006 15:04:05 -0700" |

## POST ```/transaction/period```

Получение информации об операциях, совершенных пользователем в некоторый период времени, с некоторыми статистиками при необходимости.  
Защищенный эндпойнт.

**Тело запроса**

```json
{
  "begin": "string",
  "end": "string",
  "with_summary": true
}
```

| Поле | Значение |
| ----- | --------- |
| begin | **string** <br> Начальный момент периода времени в формате "02/01/2006 15:04:05 -0700" |
| end | **string** <br> Конечный момент периода времени в таком же формате |
| with_summary | **boolean** <br> Указывает, должна ли быть собрана статистика об операциях, произведенных в данный период времени |

**Тело ответа**

```json
{
  "summary": "contains",
  "txs": [
    {
      "id": "string",
      "user_id": "string",
      "type": "string",
      "target": "string",
      "description": "string",
      "category": "string",
      "cost": 0,
      "timestamp": "string"
    }
  ]
}
```

| Поле | Значение |
| ----- | --------- |
| summary | TODO |
| txs | **string** <br> Список транзакций в формате, как выше |

# Защита

Для доступа к эндпойнтам, помеченным как защищенные, необходимо пройти процедуру аутентификации.  
Это можно сделать двумя способами:
* использовать access токен из куки, установленных при авторизации/обновлении токенов;
* установить header ```Authorization``` запроса в формате

  ```
  Authorization: Bearer <access_token>
  ```
  в случае, если возникла необходимость пройти аутентификацию в явном виде.